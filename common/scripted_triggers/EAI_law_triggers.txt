######################################################
#	Expert AI mod - law triggers
######################################################

EAI_can_upgrade_economy_law = {
	OR = {
		EAI_can_take_civilian_economy = yes
		EAI_can_take_low_economic_mobilisation = yes
		EAI_can_take_partial_economic_mobilisation = yes
		EAI_can_take_war_economy = yes
		EAI_can_take_tot_economic_mobilisation = yes
	}
}
EAI_can_upgrade_manpower_law = {
	if = { limit = { has_idea = disarmed_nation } EAI_can_take_volunteer_only = yes }
	else_if = { limit = { has_idea = volunteer_only } EAI_can_take_limited_conscription = yes }
	else_if = { limit = { has_idea = limited_conscription } EAI_can_take_extensive_conscription = yes }
	else_if = { limit = { has_idea = extensive_conscription } EAI_can_take_service_by_requirement = yes }
	else_if = { limit = { has_idea = service_by_requirement } EAI_can_take_all_adults_serve = yes }
	else_if = { limit = { has_idea = scraping_the_barrel } EAI_can_take_scraping_the_barrel = yes }
}
EAI_can_upgrade_trade_law = {
	OR = {
		EAI_can_take_free_trade = yes
		EAI_can_take_export_focus = yes
		EAI_can_take_limited_exports = yes
		EAI_can_take_closed_economy = yes
	}
}

############ eco laws

EAI_can_take_civilian_economy = {
	########## AI LOGIC

	always = no #dont take this ever

	NOT = {
		EAI_can_take_low_economic_mobilisation = yes
		EAI_can_take_partial_economic_mobilisation = yes
		EAI_can_take_war_economy = yes
		EAI_can_take_tot_economic_mobilisation = yes
	}

	NOT = {
		has_idea = low_economic_mobilisation
		has_idea = partial_economic_mobilisation
		has_idea = war_economy
		has_idea = tot_economic_mobilisation
	}

	NOT = { original_tag = USA }

	########## LAW REQUIREMENTS

	NOT = { has_idea = civilian_economy }

	NOT = { has_idea = undisturbed_isolation has_idea = isolation }
	
	### copy from idea file
}
EAI_can_take_low_economic_mobilisation = {
	########## AI LOGIC

	NOT = {
		EAI_can_take_partial_economic_mobilisation = yes
		EAI_can_take_war_economy = yes
		EAI_can_take_tot_economic_mobilisation = yes
	}

	NOT = {
		has_idea = partial_economic_mobilisation
		has_idea = war_economy
		has_idea = tot_economic_mobilisation
	}

	has_war_support > 0.25 # to avoid the AI having to demobilize

	### this law is not worth taking in the later stages when either partial or war economy are likely to become available

	date < 1938.1.1

	########## LAW REQUIREMENTS

	NOT = { has_idea = low_economic_mobilisation }

	NOT = { has_idea = undisturbed_isolation has_idea = isolation }

	### copy from idea file
	
	has_war_support > 0.15
	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}	
}
EAI_can_take_partial_economic_mobilisation = {
	########## AI LOGIC

	NOT = {
		EAI_can_take_war_economy = yes
		EAI_can_take_tot_economic_mobilisation = yes
	}

	NOT = {
		has_idea = war_economy
		has_idea = tot_economic_mobilisation
	}

	if = { limit = { original_tag = GER }
		has_completed_focus = GER_german_war_economy
	}
	if = { limit = { original_tag = JAP }
		has_completed_focus = JAP_national_mobilization_law
	}

	has_war_support > 0.35 # to avoid the AI having to demobilize

	########## LAW REQUIREMENTS

	NOT = { has_idea = partial_economic_mobilisation }

	NOT = { has_idea = undisturbed_isolation has_idea = isolation }

	### copy from idea file
	
	has_war_support > 0.25

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		OR = {
			has_completed_focus = HUN_secret_rearmament
			NOT = { has_idea = HUN_treaty_of_triannon }
		}
	}
}
EAI_can_take_war_economy = {
	########## AI LOGIC

	NOT = {
		EAI_can_take_tot_economic_mobilisation = yes
	}

	OR = {
		NOT = { has_idea = tot_economic_mobilisation }

		AND = {
			has_idea = tot_economic_mobilisation

			NOT = { has_manpower > 1000000 }

			OR = {
				has_idea = all_adults_serve
				has_idea = scraping_the_barrel
				has_idea = service_by_requirement
			}
		}
	}

	if = { limit = { original_tag = GER }
		OR = {
			has_war = yes
			has_completed_focus = GER_german_war_economy
			has_completed_focus = GER_integrate_war_economies
		}
	}
	if = { limit = { original_tag = JAP }
		OR = {
			has_completed_focus = JAP_national_mobilization_law
			is_historical_focus_on = no
		}
	}

	has_war_support > 0.55 # to avoid the AI having to demobilize

	########## LAW REQUIREMENTS

	NOT = { has_idea = war_economy }

	NOT = { has_idea = undisturbed_isolation has_idea = isolation }

	### copy from idea file
	
	has_war_support > 0.5
	OR = {
		has_government = fascism
		has_government = communism
		custom_trigger_tooltip = { tooltip = or_clarification_tooltip always = no }
		AND = {
			has_war = yes
			any_enemy_country = {
				ic_ratio = {
					tag = ROOT
					ratio > 0.4
				}
			}
		}
	}

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
}
EAI_can_take_tot_economic_mobilisation = {
	########## AI LOGIC

	original_tag = SOV

	has_manpower > 1000000

	NOT = {
		has_idea = service_by_requirement
		has_idea = all_adults_serve
		has_idea = scraping_the_barrel
	}

	########## LAW REQUIREMENTS

	NOT = { has_idea = tot_economic_mobilisation }

	NOT = { has_idea = undisturbed_isolation has_idea = isolation }

	### copy from idea file
	
	has_war = yes
	has_war_support > 0.8
	any_enemy_country = {
		ic_ratio = {
			tag = ROOT
			ratio > 0.5
		}
	}

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
}

############ conscription laws

EAI_can_take_volunteer_only = {
	########## AI LOGIC

	has_idea = disarmed_nation

	NOT = { original_tag = USA }

	NOT = { has_country_flag = EAI_mobilizing_manpower } # wait for mobilization before upgrading again

	has_manpower < 750000

	########## LAW REQUIREMENTS

	NOT = { has_idea = volunteer_only }

	NOT = { has_idea = undisturbed_isolation has_idea = isolation }

	### copy from idea file
	
	#has_manpower_for_recruit_change_to =  { value = 0.015 group = mobilization_laws }
	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
	NOT = { has_idea = undisturbed_isolation }
	NOT = { has_idea = isolation }
}
EAI_can_take_limited_conscription = {
	########## AI LOGIC

	has_idea = volunteer_only

	NOT = { original_tag = USA }

	has_war_support > 0.15

	NOT = { has_country_flag = EAI_mobilizing_manpower } # wait for mobilization before upgrading again

	OR = {
		original_tag = SOV
		has_manpower < 750000
	}

	########## LAW REQUIREMENTS

	NOT = { has_idea = limited_conscription }

	NOT = { has_idea = undisturbed_isolation has_idea = isolation }

	### copy from idea file
	
	#has_manpower_for_recruit_change_to =  { value = 0.025 group = mobilization_laws }
	has_war_support > 0.1
	NOT = { has_idea = undisturbed_isolation }
	NOT = { has_idea = isolation }
	if = {
		limit = {
			original_tag = AST
			has_dlc = "Together for Victory"
		}
		has_completed_focus = AST_citizen_military_forces
	}
	if = {
		limit = {
			original_tag = CAN
			has_dlc = "Together for Victory"
		}
		has_completed_focus = CAN_commit_to_the_war
	}
	if = {
		limit = {
			original_tag = RAJ
			has_dlc = "Together for Victory"
		}
		is_subject = no
	}

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
}
EAI_can_take_extensive_conscription = {
	########## AI LOGIC

	has_idea = limited_conscription

	if = { limit = { NOT = { has_government = communism has_government = fascism } }
		has_war_support > 0.25
	}

	NOT = { has_country_flag = EAI_mobilizing_manpower } # wait for mobilization before upgrading again

	OR = {
		original_tag = SOV
		has_manpower < 750000
	}

	########## LAW REQUIREMENTS

	NOT = { has_idea = extensive_conscription }

	### copy from idea file
	
	#has_manpower_for_recruit_change_to = { value = 0.05 group = mobilization_laws }
	OR = {
		has_government = fascism
		has_government = communism
		AND = {
			has_war = yes
			enemies_strength_ratio > 0.5
			#any_enemy_country = {
			#	strength_ratio = {
			#		tag = ROOT
			#		ratio > 0.5
			#	}
			#}
		}
	}
	has_war_support > 0.2
	#Special rules AST in TFV
	if = {
		limit = {
			original_tag = AST
			has_dlc = "Together for Victory"
		}
		has_completed_focus = AST_citizen_military_forces
		has_completed_focus = AST_fight_work_or_perish
	}
	if = {
		limit = {
			original_tag = CAN
			has_dlc = "Together for Victory"
		}
		has_completed_focus = CAN_commit_to_the_war
		has_completed_focus = CAN_if_day
	}
	if = {
		limit = {
			original_tag = RAJ
			has_dlc = "Together for Victory"
		}
		is_subject = no
	}

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
}
EAI_can_take_service_by_requirement = {
	########## AI LOGIC

	has_idea = extensive_conscription

	if = { limit = { NOT = { has_government = communism has_government = fascism } }
		has_war_support > 0.65
	}

	NOT = { has_country_flag = EAI_mobilizing_manpower } # wait for mobilization before upgrading again

	if = { 		limit = { has_army_manpower = { size < 1900000 } } has_manpower < 500000 }
	else_if = { limit = { has_army_manpower = { size < 2000000 } } has_manpower < 530000 }
	else_if = { limit = { has_army_manpower = { size < 2100000 } } has_manpower < 530000 }
	else_if = { limit = { has_army_manpower = { size < 2100000 } } has_manpower < 530000 }
	else_if = { limit = { has_army_manpower = { size < 2200000 } } has_manpower < 550000 }
	else_if = { limit = { has_army_manpower = { size < 2300000 } } has_manpower < 580000 }
	else_if = { limit = { has_army_manpower = { size < 2400000 } } has_manpower < 600000 }
	else_if = { limit = { has_army_manpower = { size < 2500000 } } has_manpower < 630000 }
	else_if = { limit = { has_army_manpower = { size < 2600000 } } has_manpower < 650000 }
	else_if = { limit = { has_army_manpower = { size < 2700000 } } has_manpower < 680000 }
	else_if = { limit = { has_army_manpower = { size < 2800000 } } has_manpower < 700000 }
	else_if = { limit = { has_army_manpower = { size < 2900000 } } has_manpower < 730000 }

	else_if = { limit = { has_army_manpower = { size < 3000000 } } has_manpower < 750000 }
	else_if = { limit = { has_army_manpower = { size < 3200000 } } has_manpower < 800000 }
	else_if = { limit = { has_army_manpower = { size < 3400000 } } has_manpower < 850000 }
	else_if = { limit = { has_army_manpower = { size < 3600000 } } has_manpower < 900000 }
	else_if = { limit = { has_army_manpower = { size < 3800000 } } has_manpower < 950000 }

	else_if = { limit = { has_army_manpower = { size < 4000000 } } has_manpower < 1050000 }
	else_if = { limit = { has_army_manpower = { size < 4200000 } } has_manpower < 1100000 }
	else_if = { limit = { has_army_manpower = { size < 4400000 } } has_manpower < 1150000 }
	else_if = { limit = { has_army_manpower = { size < 4600000 } } has_manpower < 1200000 }
	else_if = { limit = { has_army_manpower = { size < 4800000 } } has_manpower < 1250000 }

	else_if = { limit = { has_army_manpower = { size < 5000000 } } has_manpower < 1250000 }
	else_if = { limit = { has_army_manpower = { size < 5200000 } } has_manpower < 1300000 }
	else_if = { limit = { has_army_manpower = { size < 5400000 } } has_manpower < 1350000 }
	else_if = { limit = { has_army_manpower = { size < 5600000 } } has_manpower < 1400000 }
	else_if = { limit = { has_army_manpower = { size < 5800000 } } has_manpower < 1450000 }

	########## LAW REQUIREMENTS

	NOT = { has_idea = service_by_requirement }

	### copy from idea file
	
	#has_manpower_for_recruit_change_to =  { value = 0.1 group = mobilization_laws }
	OR = {
		has_government = fascism
		has_government = communism
		AND = {
			has_war = yes
			enemies_strength_ratio > 0.6
			#any_enemy_country = {
			#	strength_ratio = {
			#		tag = ROOT 
			#		ratio > 0.6
			#	}
			#}
		}
	}
	OR = {
		has_war_support > 0.6
		surrender_progress > 0
	}

	if = {
		limit = {
			original_tag = AST
			has_dlc = "Together for Victory"
		}
		has_completed_focus = AST_citizen_military_forces
		has_completed_focus = AST_fight_work_or_perish
	}

	if = {
		limit = {
			original_tag = CAN
			has_dlc = "Together for Victory"
		}
		OR = {
			has_completed_focus = CAN_compromise_with_quebec
			has_completed_focus = CAN_forced_quebec_conscription
		}
	}
	if = {
		limit = {
			original_tag = RAJ
			has_dlc = "Together for Victory"
		}
		is_subject = no
	}

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
}
EAI_can_take_all_adults_serve = {
	########## AI LOGIC

	has_idea = service_by_requirement

	NOT = { has_idea = tot_economic_mobilisation }

	OR = { #mobile warfare countries should get manpower techs before getting this law
		AND = {
			has_tech = mobile_warfare
			has_tech = nd_conscription
		}
		NOT = { has_tech = mobile_warfare }
	}

	NOT = { has_country_flag = EAI_mobilizing_manpower } # wait for mobilization before upgrading again

	has_manpower < 250000

	amount_manpower_in_deployment_queue < 250000

	########## LAW REQUIREMENTS

	NOT = { has_idea = all_adults_serve }

	### copy from idea file
	
	#has_manpower_for_recruit_change_to =  { value = 0.2 group = mobilization_laws }
	has_war = yes
	OR = {
		has_war_support > 0.7
		surrender_progress > 0
	}
	enemies_strength_ratio > 0.75
	#any_enemy_country = {
	#	strength_ratio = {
	#		tag = ROOT
	#		ratio > 0.75
	#	}
	#}

	if = {
		limit = {
			original_tag = AST
			has_dlc = "Together for Victory"
		}
		has_completed_focus = AST_citizen_military_forces
		has_completed_focus = AST_fight_work_or_perish
	}

	if = {
		limit = {
			original_tag = CAN
			has_dlc = "Together for Victory"
		}
		OR = {
			has_completed_focus = CAN_compromise_with_quebec
			has_completed_focus = CAN_forced_quebec_conscription
		}
	}
	if = {
		limit = {
			original_tag = RAJ
			has_dlc = "Together for Victory"
		}
		is_subject = no
	}

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
}
EAI_can_take_scraping_the_barrel = {
	########## AI LOGIC

	has_idea = all_adults_serve

	NOT = { has_idea = tot_economic_mobilisation }

	if = { limit = { has_country_flag = EAI_FOCUS/MW_doctrine }
		has_tech = nd_conscription
	}

	NOT = { has_country_flag = EAI_mobilizing_manpower } # wait for mobilization before upgrading again

	has_manpower < 250000

	amount_manpower_in_deployment_queue < 250000

	########## LAW REQUIREMENTS

	NOT = { has_idea = scraping_the_barrel }
	
	### copy from idea file

	#has_manpower_for_recruit_change_to =  { value = 0.25 group = mobilization_laws }
	has_war = yes
	OR = {
		has_war_support > 0.85
		surrender_progress > 0.25
	}
	enemies_strength_ratio > 1
	#any_enemy_country = {
	#	strength_ratio = {
	#		tag = ROOT
	#		ratio > 1
	#	}
	#}
	if = {
		limit = {
			original_tag = AST
			has_dlc = "Together for Victory"
		}
		has_completed_focus = AST_citizen_military_forces
		has_completed_focus = AST_fight_work_or_perish
	}

	if = {
		limit = {
			original_tag = CAN
			has_dlc = "Together for Victory"
		}
		OR = {
			has_completed_focus = CAN_compromise_with_quebec
			has_completed_focus = CAN_forced_quebec_conscription
		}
	}
	if = {
		limit = {
			original_tag = RAJ
			has_dlc = "Together for Victory"
		}
		is_subject = no
	}

	if = {
		limit = {
			original_tag = HUN
			has_dlc = "Death or Dishonor"
		}
		NOT = { has_idea = HUN_treaty_of_triannon }
	}
}

########### trade laws

EAI_can_take_free_trade = {
	########## AI LOGIC

	### special case

	if = { 
		limit = {
			OR = {
				original_tag = ENG
				original_tag = FRA
			}
		}

		has_war = no
		date > 1942.1.1
	}

	### only these countries are allowed to take free trade

	OR = { 
		has_government = neutrality
		has_government = democratic
		NOT = { EAI_major_country = yes }
	}

	### law allowed when need < 20% 

	check_variable = { var = EAI_average_resource_need value = 0.20 compare = less_than }

	### if trade law was recently changed, the difference in need has to be greater to prevent wasted PP due to random fluctuations

	if = { limit = { has_country_flag = EAI_trade_law_recently_changed }

		check_variable = { var = EAI_average_resource_need value = 0.10 compare = less_than }
	}
		
	########## LAW REQUIREMENTS

	NOT = { has_idea = free_trade }
	
	### copy from idea file
}
EAI_can_take_export_focus = {
	########## AI LOGIC

	### special case

	if = { 
		limit = {
			OR = {
				original_tag = JAP
				original_tag = ITA
			}
		}

		has_war = no
		date > 1942.1.1
	}

	### normal range: 20-60%

	if = { # if allowed to take free trade
		limit = {
			OR = {
				has_government = neutrality
				has_government = democratic
				NOT = { EAI_major_country = yes }
			}
		}

		### law allowed when need >= 20% 

		check_variable = { var = EAI_average_resource_need value = 0.20 compare = greater_than_or_equals }
	}

	check_variable = { var = EAI_average_resource_need value = 0.60 compare = less_than }

	### if trade law was recently changed, the difference in need has to be greater to prevent wasted PP due to random fluctuations

	if = { limit = { has_country_flag = EAI_trade_law_recently_changed } # 30-40%

		check_variable = { var = EAI_average_resource_need value = 0.40 compare = less_than }

		if = { # if allowed to take free trade
			limit = {
				OR = {
					has_government = neutrality
					has_government = democratic
					NOT = { EAI_major_country = yes }
				}
			}

			check_variable = { var = EAI_average_resource_need value = 0.30 compare = greater_than_or_equals }
		}
	}

	########## LAW REQUIREMENTS

	NOT = { has_idea = export_focus }
	
	### copy from idea file

	if = {
		limit = {
			original_tag = CHI
			has_dlc = "Waking the Tiger"
		}
		NOT = { has_idea = CHI_nine_power_treaty }
	}
}
EAI_can_take_limited_exports = {
	########## AI LOGIC

	### normal range: >= 60%

	check_variable = { var = EAI_average_resource_need value = 0.60 compare = greater_than_or_equals }

	### if trade law was recently changed, the difference in need has to be greater to prevent wasted PP due to random fluctuations

	if = { limit = { has_country_flag = EAI_trade_law_recently_changed } # >= 70%

		check_variable = { var = EAI_average_resource_need value = 0.70 compare = greater_than_or_equals }
	}

	########## LAW REQUIREMENTS

	NOT = { has_idea = limited_exports }

	### copy from idea file
	
	OR = {
		AND = {
			has_government = democratic
			has_war = yes
			any_enemy_country = {
				ic_ratio = {
					tag = ROOT
					ratio > 0.2
				}
			}
		}
		AND = {
			NOT = { has_government = democratic }
			OR = {
				has_idea = partial_economic_mobilisation
				has_idea = war_economy
				has_idea = tot_economic_mobilisation
			}
		}
	}


	if = {
		limit = {
			original_tag = CHI
			has_dlc = "Waking the Tiger"
		}
		NOT = { has_idea = CHI_nine_power_treaty }
	}
}
EAI_can_take_closed_economy = {
	########## AI LOGIC

	always = no #dont take this ever

	########## LAW REQUIREMENTS

	NOT = { has_idea = closed_economy }

	### copy from idea file
	
	has_war = yes
	OR = {
		has_government = fascism
		has_government = communism
	}
	OR = {
		has_idea = war_economy
		has_idea = tot_economic_mobilisation
	}
	OR = {
		NOT = {	tag = SOV }
		NOT = { has_opinion_modifier = MR_pact }
	}

	if = {
		limit = {
			original_tag = CHI
			has_dlc = "Waking the Tiger"
		}
		NOT = { has_idea = CHI_nine_power_treaty }
	}
}